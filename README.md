# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в проекте

Карточка товара

```
IProductCard - интерфейс, представляющий товар в каталоге.
Содержит следующие свойства: 
    id - уникальный идентификатор товара 
    description - описание товара
    image - изображение товара
    title - название товара
    category - категория товара
    price - стоимость товара, может быть null, если стоимость не задана
    button - элемент кнопки HTML, связанный с товаром
```

Формы заказа 

```
IModelForms - интерфейс для сбора данных формы. Включает в себя поля:
    payment - способ оплаты
    address - адрес доставки
    email - электронная почта покупателя
    phone - номер телефона покупателя
```
Дополнительные свойства заказа 

```
IOrder расширяет интерфейс IModelForms, добавляя свойства для заказа:
    items - массив сторок, который представляет идентификаторы товаров в заказе
    total - общая сумма заказа
```

Объединение данных товара и текущего заказа

```
IProductCardsData - интерфейс, который объединяет данные о продуктовой карточке, корзине и текущем заказе:
    cards - массив объектов, соотвествующих интерфейсу IProductCard
    basket -  массив строк, представляющий идентификаторы товаров в корзине
    order -  может быть объект типа IOrder или null, если заказа нет.
```

Результат заказа

```
IOrderResult - интерфейс, представляющий результат заказа, с идентификатором и общей суммой.
```

Вспомогательные типы

```
IBasketItem - тип, извлекающий  определенные поля из интерфейса IProductCard (идентификатор, название и цена). Позволяет создать более легковестные объекты для отображения в корзине, без передачи все информации о товаре. 
```
```
FormErrors - тип, представляющий ошибки формы. Позволяет создать более гибкий механизм обработки ошибок при работе с формами.
```

## Архитектура проекта

Код проекта основан на MVP - паттерне и разделен на слои: 
- слой данных (Model) — отвечает за хранение и изменения данных;
- слой отображения (View) — отвечает за отображение данных на странице;
- слой управления (Presenter) — отвечает за связь отображения и данных.


### Базовый код 

#### Класс Api 
Реализует базовый набор сетевых операций с серверным Api (получение и отправка данных).
Используемые методы: 
- `get` - для получения данных с севрера. Выполняет GET запрос;
- `post`- для отправки данных на сервер. По умолчанию выполняет POST запрос. 

#### Класс EventEmitter
Обеспечивает работу событий. Его функции: возможность установить и снять слушателей событий, вызвать слушателей при возникновении события.
Основные методы, реализуемые классом `IEvents`: 
- `on` - подписка на событие;
- `off` - снятие обработчика с события;
- `emit`- инициализация события;
- `onAll` - подписка на все события;
- `offAll` - снятие обработчика со всех событий;
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в праметрах событие. 

#### Класс Model
Базовый класс для создания классов моделей данных. Содержит метод **emitChanges**, который уведомляет о том, что данные в модели изменились.  

#### Класс Component 
Базовый класс для компонентов представления. Содержит методы:
- toggleClass - переключает класс элемента;
- setText - устанавливает текстовое содержание;
- setDisabled - меняет статус блокировки экрана;
- setHidden - скрывает элемент;
- setVisible - делает элемент видимым;
- setImage - устанавливает изображение с альтернативным текстом;
- render - возвращает корневой DOM-элемент. 

### Слой данных (Model)

#### Класс CardData
Класс отвечает за управление состоянием данных, связанным с карточками продуктов и корзиной.\
Конструктор класса принимает инстант брокера событий.\
Наследуется от класса Model, что позволяет ему использовать общие механизмы работы с событиями и данными, определённые в родительском классе.\
В полях класса хранятся следующие данные:
- basket - массив объектов карточек, добавленных в корзину;
- catalog - массив объектов карточек, доступных в каталоге;
- order - объект, представляющий заказ, со всеми необходимыми полями;
- formErrors - объект для хранения ошибок валидации форм.

Так же класс представляет собой набор методов для взаимодействия с этими данными: 
- getTotal - вычисляет общую стоимость всех товаров в корзине, используя метод reduce;
- setCatalog - обновляет каталог товаров и уведомляет об изменениях через событие;
- addProductToBasket  - добавляет товар в корзину, обновляя соответствующие данные в заказе и эмитируя события о изменениях ;
- deleteProductFromBasket - удаляет товар из корзины, обновляя соответствующие данные в заказе и эмитируя события о изменениях;
- checkProduct - проверяет объект карточки на добавление в корзину его идентификатору; 

Так же класс содержит валидацию форм: **setBuyerField, setOrderField, validateContact, и validateOrder**, которые управляют полями формы покупателя и заказа, а также выполняют валидацию данных. Если валидация не пройдена, ошибки обновляются, и соответствующие события эмитируются.

### Слой отображения (View)
Классы, отвечающие за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Page
Отвечает за отображение блока с карточками товара на главной странице, элемент счетчика товаров в корзине и иконку, при клике на которую открывается модальное окно корзины.\
Наследуется от базового класса `Component`.\
Поля класса:
- pageCounter - элемент счетчика корзины;
- pageCatalog - элемент каталога;
- pageWrapper - обертка страницы;
- pageBasket - эелемент корзины.

Используемые сеттеры:
- counter - обновляет визуальное представление счетчика товаров в корзине, преобразуя числовое значение в строку;
- catalog - заменяет содержимое элемента каталога на новые карточки товаров, полученные как массив HTML-элементов;
- locked - изменяет класс страницы, добавляя или убирая состояние блокировки.

#### Класс Сard
Отвечает за отображение карточки, задавая в карточке данные категория, название, описание, стоимость и изображение товара. Класс используется для отображения карточек товара на странице сайта. В конструкторе класса передается DOM-элемент темплейта, что позволяет формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на кнопки, в результате чего при взаимодействии пользователя с этими кнопками генерируется соотвествующее событие.\
Наследуется от базового класса `Component`.\
Поля класса:
- title - элемент заголовка карточки; 
- description - элемент описания товара;
- category - элемент категории товара;
- image - элемент изображения товара;
- price - элемент стоимости товара;
- button - элемент кнопки;
- index - элемент счетчика корзины.

Используемые сеттеры:
- id - устанавливает значение идентификатора для данных карточки;
- title - устанавливает или возвращает текст заголовка карточки;
- description - устанавливает текст описания карточки;
- category - устанавливает текст и добавляет соответствующий класс категории;
- image - устанавливает изображение для карточки;
- price - устанавливает текст цены карточки. Если значение null. то текст 'Бесценно';
- index - устанавливает счетчик корзины

#### Класс Modal
Реализует модальное окно. Наследуется от базового класса `Component`. Предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушателя на клавиатуру, на клик в оверлей и на кнопку-крестик для закрытия попапа. 
- constructor(container: HTMLElement, protected events: IEvents) - конструктор принимает контейнер, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- modalCloseButton - кнопка закрытия модального окна;
- modalContent- содержимое модального окна. 

#### Класс Form
Родительский класс для двух классов, предназначенных для реализации модальных окон с формой содержащей поля ввода. Одна форма с выбором способа оплаты и вводом адреса доставки, вторая с контактными данными. При сабмите инициирует событие передавая в него объект с данными из полей ввода формы. При изменении данных инициируется событие изменения данных.\
Предоставляет методы для отображения ошибок и управления активностью кнопки подтверждения.\
Наследуется от базового класса `Component`.\
Поля класса:
- formSubmit - кнопка подтверждения;
- formErrors - элемент для отображения ошибок валидации.

Методы:
- onInputChange - эмитирует событие изменения поля ввода при каждом изменении текста в поле, передавая имя поля и новое значение;
- valid - изменяет активность кнопки подтверждения в зависимости от валидности формы;
- errors - устанавливает текст ошибок формы для отображения. 
- render - генерирует разметку на основании полученных данных, обновляя текущие свойства, передает валидность и ошибки.

#### Класс Basket
Класс отвечает за управление данными и функционалом корзины. Наследуется от базового класса `Component`.\
Поля класса:
- basketList - элемент списка товаров в корзине;
- basketTotal - элемент для отображения общей суммы товаров в корзине;
- basketButton - элемент кнопки для открытия оформления заказа.

Используемые сеттеры:
 - items - управляет содержимым списка товаров в корзине, а так же обновляет его;
 - selected - активирует/жеактивирует кнопку в зависимости от выбранных элементов;
 - total - обновляет текст общей стоимости.

 #### Класс Success
Предназначен для отображения сообщения об успешном завершении заказа. Конструктор принимает селектор элемента, в который будет выводиться сообщение.\
Наследуется от базового класса `Component`.
В полях класса хранятся следующие данные:
- total- отображает общую сумму списания.

#### Класс Order
Компонент для оформления заказа. Расширяет класс `Form`.
Для каждой кнопки добавляется слушатель событий , который устанавливает состояние оплаты и эмитируют событие изменения способа оплаты.\
Поля класса:
- orderButtons - массив кнопок формы выбора способа оплаты. 

Используемые сеттеры:
- address - устанавливает значение адреса;
- payment - устанавливает выбранный способ оплаты и применяет соответствующий стиль к кнопке.

#### Класс Contacts
Компонент контактной информации покупателя. Расширяет класс `Form`.\
Используемые сеттеры:
- phone - устанавливает значение поля телефона в форме;
- email -устанавливает значение поля электронной почты в форме.

### Слой управления (Presenter) 

#### Класс CardsApi
Принимает в конструктор экземпляр класса Api и предоставляет методы, которые реализуют взаимодействие с бэкендом сервиса.\
Методы класса:
- getCardList - получение списка товаров в ввиде массива;
- orderCards - оформление заказа с передачей информации о заказе, получение результатов заказа. 

## Взаимодействие компонентов
Код, описывающий взаимодействие отображения и данных между собой находится в файле `index.ts`, выполняющий роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчика этих событий, описанных в `index.ts`.\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.\
**В приложении используются следующие события:**
- items:changed - изменение каталога товаров;
- card:select - нажатие на карточку товара;
- preview:changed - открытие карточки товара;
- basket:open - открытие корзины;
- basket:changed - изменение содержимого корзины;
- card:add - добавление карточки;
- card:remove - удаление карточки;
- formErrorsContact:change - изменение состояния валидации формы контактов;
- order:submit - открытие формы контактов;
- formErrorsOrder:change - изменение состояния валидации формы заказа;
- order:open - открытие формы заказа;
- payment:change - изменение типа оплаты;
- contacts:submit - успешная оплата заказа;
- modal:open - открытие модального окна;
- modal:close - закрытие модального окна;
- /^order..*:change/ - изменение полей в форме заказа;
- /^contacts..*:change/ - изменение полей в форме контактов.
